



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="自然语言处理文档">
      
      
      
        <meta name="author" content="Nosy">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.0">
    
    
      
        <title>Tests - Flask Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#test-coverage" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Flask Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Flask Docs
            </span>
            <span class="md-header-nav__topic">
              Tests
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/wohugb/nlp-docs" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    nlp-docs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="欢迎来到 Flask" class="md-tabs__link">
        欢迎来到 Flask
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../deploying/" title="Deploying" class="md-tabs__link">
          Deploying
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../patterns/" title="Patterns" class="md-tabs__link">
          Patterns
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Tutorial" class="md-tabs__link md-tabs__link--active">
          Tutorial
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Flask Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Flask Docs
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/wohugb/nlp-docs" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    nlp-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="欢迎来到 Flask" class="md-nav__link">
      欢迎来到 Flask
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../10.foreword/" title="前言" class="md-nav__link">
      前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../11.advanced_foreword/" title="有经验的程序员的前言" class="md-nav__link">
      有经验的程序员的前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../12.installation/" title="安装" class="md-nav__link">
      安装
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../13.quickstart/" title="Quickstart" class="md-nav__link">
      Quickstart
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../15.templating/" title="Templates" class="md-nav__link">
      Templates
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../appcontext/" title="Appcontext" class="md-nav__link">
      Appcontext
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../becomingbig/" title="Becoming Big" class="md-nav__link">
      Becoming Big
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../blueprints/" title="Modular Applications with Blueprints" class="md-nav__link">
      Modular Applications with Blueprints
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../cli/" title="Cli" class="md-nav__link">
      Cli
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../config/" title="Configuration Handling" class="md-nav__link">
      Configuration Handling
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../design/" title="Design Decisions in Flask" class="md-nav__link">
      Design Decisions in Flask
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../errorhandling/" title="Application Errors" class="md-nav__link">
      Application Errors
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../extensiondev/" title="Flask Extension Development" class="md-nav__link">
      Flask Extension Development
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../htmlfaq/" title="HTML/XHTML FAQ" class="md-nav__link">
      HTML/XHTML FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../latexindex/" title="Latexindex" class="md-nav__link">
      Latexindex
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../reqcontext/" title="Reqcontext" class="md-nav__link">
      Reqcontext
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../security/" title="Security Considerations" class="md-nav__link">
      Security Considerations
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../server/" title="Development Server" class="md-nav__link">
      Development Server
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../shell/" title="Working with the Shell" class="md-nav__link">
      Working with the Shell
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../signals/" title="Signals" class="md-nav__link">
      Signals
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../styleguide/" title="Pocoo Styleguide" class="md-nav__link">
      Pocoo Styleguide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../testing/" title="Testing Flask Applications" class="md-nav__link">
      Testing Flask Applications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../unicode/" title="Unicode in Flask" class="md-nav__link">
      Unicode in Flask
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../upgrading/" title="Upgrading to Newer Releases" class="md-nav__link">
      Upgrading to Newer Releases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../views/" title="Pluggable Views" class="md-nav__link">
      Pluggable Views
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-33" type="checkbox" id="nav-33">
    
    <label class="md-nav__link" for="nav-33">
      Deploying
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-33">
        Deploying
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploying/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploying/cgi/" title="CGI" class="md-nav__link">
      CGI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploying/fastcgi/" title="Fastcgi" class="md-nav__link">
      Fastcgi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploying/mod_wsgi/" title="Mod wsgi" class="md-nav__link">
      Mod wsgi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploying/uwsgi/" title="Uwsgi" class="md-nav__link">
      Uwsgi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploying/wsgi-standalone/" title="Wsgi standalone" class="md-nav__link">
      Wsgi standalone
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-34" type="checkbox" id="nav-34">
    
    <label class="md-nav__link" for="nav-34">
      Patterns
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-34">
        Patterns
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/apierrors/" title="Implementing API Exceptions" class="md-nav__link">
      Implementing API Exceptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/appdispatch/" title="Appdispatch" class="md-nav__link">
      Appdispatch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/appfactories/" title="Appfactories" class="md-nav__link">
      Appfactories
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/caching/" title="Caching" class="md-nav__link">
      Caching
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/celery/" title="Celery Background Tasks" class="md-nav__link">
      Celery Background Tasks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/deferredcallbacks/" title="Deferredcallbacks" class="md-nav__link">
      Deferredcallbacks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/distribute/" title="Distribute" class="md-nav__link">
      Distribute
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/errorpages/" title="Errorpages" class="md-nav__link">
      Errorpages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/fabric/" title="Fabric" class="md-nav__link">
      Fabric
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/favicon/" title="Adding a favicon" class="md-nav__link">
      Adding a favicon
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/fileuploads/" title="Fileuploads" class="md-nav__link">
      Fileuploads
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/flashing/" title="Flashing" class="md-nav__link">
      Flashing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/jquery/" title="AJAX with jQuery" class="md-nav__link">
      AJAX with jQuery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/lazyloading/" title="Lazily Loading Views" class="md-nav__link">
      Lazily Loading Views
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/methodoverrides/" title="Adding HTTP Method Overrides" class="md-nav__link">
      Adding HTTP Method Overrides
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/mongoengine/" title="MongoDB with MongoEngine" class="md-nav__link">
      MongoDB with MongoEngine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/mongokit/" title="Mongokit" class="md-nav__link">
      Mongokit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/packages/" title="Packages" class="md-nav__link">
      Packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/requestchecksum/" title="Request Content Checksums" class="md-nav__link">
      Request Content Checksums
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/singlepageapplications/" title="Single-Page Applications" class="md-nav__link">
      Single-Page Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/sqlalchemy/" title="Sqlalchemy" class="md-nav__link">
      Sqlalchemy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/sqlite3/" title="Sqlite3" class="md-nav__link">
      Sqlite3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/streaming/" title="Streaming Contents" class="md-nav__link">
      Streaming Contents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/subclassing/" title="Subclassing Flask" class="md-nav__link">
      Subclassing Flask
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/templateinheritance/" title="Templateinheritance" class="md-nav__link">
      Templateinheritance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/urlprocessors/" title="Using URL Processors" class="md-nav__link">
      Using URL Processors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/viewdecorators/" title="View Decorators" class="md-nav__link">
      View Decorators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns/wtforms/" title="Form Validation with WTForms" class="md-nav__link">
      Form Validation with WTForms
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35" type="checkbox" id="nav-35" checked>
    
    <label class="md-nav__link" for="nav-35">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-35">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blog/" title="Blog" class="md-nav__link">
      Blog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../database/" title="Database" class="md-nav__link">
      Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy/" title="Deploy to Production" class="md-nav__link">
      Deploy to Production
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../factory/" title="Factory" class="md-nav__link">
      Factory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install/" title="Make the Project Installable" class="md-nav__link">
      Make the Project Installable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../layout/" title="Project Layout" class="md-nav__link">
      Project Layout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../next/" title="Keep Developing!" class="md-nav__link">
      Keep Developing!
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../static/" title="Static Files" class="md-nav__link">
      Static Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../templates/" title="Templates" class="md-nav__link">
      Templates
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Tests
      </label>
    
    <a href="./" title="Tests" class="md-nav__link md-nav__link--active">
      Tests
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-and-fixtures" title="Setup and Fixtures" class="md-nav__link">
    Setup and Fixtures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#factory" title="Factory" class="md-nav__link">
    Factory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database" title="Database" class="md-nav__link">
    Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication" title="Authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blog" title="Blog" class="md-nav__link">
    Blog
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-tests" title="Running the Tests" class="md-nav__link">
    Running the Tests
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/" title="Views" class="md-nav__link">
      Views
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-and-fixtures" title="Setup and Fixtures" class="md-nav__link">
    Setup and Fixtures
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#factory" title="Factory" class="md-nav__link">
    Factory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database" title="Database" class="md-nav__link">
    Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication" title="Authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blog" title="Blog" class="md-nav__link">
    Blog
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-tests" title="Running the Tests" class="md-nav__link">
    Running the Tests
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <p>.. currentmodule:: flask</p>
<h1 id="test-coverage">Test Coverage<a class="headerlink" href="#test-coverage" title="Permanent link">&para;</a></h1>
<p>Writing unit tests for your application lets you check that the code
you wrote works the way you expect. Flask provides a test client that
simulates requests to the application and returns the response data.</p>
<p>You should test as much of your code as possible. Code in functions only
runs when the function is called, and code in branches, such as <code>if</code>
blocks, only runs when the condition is met. You want to make sure that
each function is tested with data that covers each branch.</p>
<p>The closer you get to 100% coverage, the more comfortable you can be
that making a change won't unexpectedly change other behavior. However,
100% coverage doesn't guarantee that your application doesn't have bugs.
In particular, it doesn't test how the user interacts with the
application in the browser. Despite this, test coverage is an important
tool to use during development.</p>
<p>.. note::
This is being introduced late in the tutorial, but in your future
projects you should test as you develop.</p>
<p>You'll use <code>pytest</code><em> and <code>coverage</code></em> to test and measure your code.
Install them both:</p>
<p>.. code-block:: none</p>
<div class="codehilite"><pre><span></span>$ pip install pytest coverage
</pre></div>


<p>.. _pytest: https://pytest.readthedocs.io/
.. _coverage: https://coverage.readthedocs.io/</p>
<h2 id="setup-and-fixtures">Setup and Fixtures<a class="headerlink" href="#setup-and-fixtures" title="Permanent link">&para;</a></h2>
<p>The test code is located in the <code>tests</code> directory. This directory is
<em>next to</em> the <code>flaskr</code> package, not inside it. The
<code>tests/conftest.py</code> file contains setup functions called <em>fixtures</em>
that each test will use. Tests are in Python modules that start with
<code>test_</code>, and each test function in those modules also starts with
<code>test_</code>.</p>
<p>Each test will create a new temporary database file and populate some
data that will be used in the tests. Write a SQL file to insert that
data.</p>
<p>.. code-block:: sql
:caption: <code>tests/data.sql</code></p>
<div class="codehilite"><pre><span></span><span class="nt">INSERT</span> <span class="nt">INTO</span> <span class="nt">user</span> <span class="o">(</span><span class="nt">username</span><span class="o">,</span> <span class="nt">password</span><span class="o">)</span>
<span class="nt">VALUES</span>
  <span class="o">(</span><span class="s1">&#39;test&#39;</span><span class="o">,</span> <span class="s1">&#39;pbkdf2:sha256:50000$TCI4GzcX$0de171a4f4dac32e3364c7ddc7c14f3e2fa61f2d17574483f7ffbb431b4acb2f&#39;</span><span class="o">),</span>
  <span class="o">(</span><span class="s1">&#39;other&#39;</span><span class="o">,</span> <span class="s1">&#39;pbkdf2:sha256:50000$kJPKsz6N$d2d4784f1b030a9761f5ccaeeaca413f27f2ecb76d6168407af962ddce849f79&#39;</span><span class="o">);</span>

<span class="nt">INSERT</span> <span class="nt">INTO</span> <span class="nt">post</span> <span class="o">(</span><span class="nt">title</span><span class="o">,</span> <span class="nt">body</span><span class="o">,</span> <span class="nt">author_id</span><span class="o">,</span> <span class="nt">created</span><span class="o">)</span>
<span class="nt">VALUES</span>
  <span class="o">(</span><span class="s1">&#39;test title&#39;</span><span class="o">,</span> <span class="s1">&#39;test&#39;</span> <span class="o">||</span> <span class="nt">x</span><span class="s1">&#39;0a&#39;</span> <span class="o">||</span> <span class="s1">&#39;body&#39;</span><span class="o">,</span> <span class="nt">1</span><span class="o">,</span> <span class="s1">&#39;2018-01-01 00:00:00&#39;</span><span class="o">);</span>
</pre></div>


<p>The <code>app</code> fixture will call the factory and pass <code>test_config</code> to
configure the application and database for testing instead of using your
local development configuration.</p>
<p>.. code-block:: python
:caption: <code>tests/conftest.py</code></p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">flaskr</span> <span class="kn">import</span> <span class="n">create_app</span>
<span class="kn">from</span> <span class="nn">flaskr.db</span> <span class="kn">import</span> <span class="n">get_db</span><span class="p">,</span> <span class="n">init_db</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;data.sql&#39;</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">_data_sql</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>


<span class="nd">@pytest.fixture</span>
<span class="k">def</span> <span class="nf">app</span><span class="p">():</span>
    <span class="n">db_fd</span><span class="p">,</span> <span class="n">db_path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">({</span>
        <span class="s1">&#39;TESTING&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s1">&#39;DATABASE&#39;</span><span class="p">:</span> <span class="n">db_path</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
        <span class="n">init_db</span><span class="p">()</span>
        <span class="n">get_db</span><span class="p">()</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">_data_sql</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">app</span>

    <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">db_fd</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>


<span class="nd">@pytest.fixture</span>
<span class="k">def</span> <span class="nf">client</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>


<span class="nd">@pytest.fixture</span>
<span class="k">def</span> <span class="nf">runner</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">test_cli_runner</span><span class="p">()</span>
</pre></div>


<p>:func:<code>tempfile.mkstemp</code> creates and opens a temporary file, returning
the file object and the path to it. The <code>DATABASE</code> path is
overridden so it points to this temporary path instead of the instance
folder. After setting the path, the database tables are created and the
test data is inserted. After the test is over, the temporary file is
closed and removed.</p>
<p>:data:<code>TESTING</code> tells Flask that the app is in test mode. Flask changes
some internal behavior so it's easier to test, and other extensions can
also use the flag to make testing them easier.</p>
<p>The <code>client</code> fixture calls
:meth:<code>app.test_client() &lt;Flask.test_client&gt;</code> with the application
object created by the <code>app</code> fixture. Tests will use the client to make
requests to the application without running the server.</p>
<p>The <code>runner</code> fixture is similar to <code>client</code>.
:meth:<code>app.test_cli_runner() &lt;Flask.test_cli_runner&gt;</code> creates a runner
that can call the Click commands registered with the application.</p>
<p>Pytest uses fixtures by matching their function names with the names
of arguments in the test functions. For example, the <code>test_hello</code>
function you'll write next takes a <code>client</code> argument. Pytest matches
that with the <code>client</code> fixture function, calls it, and passes the
returned value to the test function.</p>
<h2 id="factory">Factory<a class="headerlink" href="#factory" title="Permanent link">&para;</a></h2>
<p>There's not much to test about the factory itself. Most of the code will
be executed for each test already, so if something fails the other tests
will notice.</p>
<p>The only behavior that can change is passing test config. If config is
not passed, there should be some default configuration, otherwise the
configuration should be overridden.</p>
<p>.. code-block:: python
:caption: <code>tests/test_factory.py</code></p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">flaskr</span> <span class="kn">import</span> <span class="n">create_app</span>


<span class="k">def</span> <span class="nf">test_config</span><span class="p">():</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">create_app</span><span class="p">()</span><span class="o">.</span><span class="n">testing</span>
    <span class="k">assert</span> <span class="n">create_app</span><span class="p">({</span><span class="s1">&#39;TESTING&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span><span class="o">.</span><span class="n">testing</span>


<span class="k">def</span> <span class="nf">test_hello</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;Hello, World!&#39;</span>
</pre></div>


<p>You added the <code>hello</code> route as an example when writing the factory at
the beginning of the tutorial. It returns "Hello, World!", so the test
checks that the response data matches.</p>
<h2 id="database">Database<a class="headerlink" href="#database" title="Permanent link">&para;</a></h2>
<p>Within an application context, <code>get_db</code> should return the same
connection each time it's called. After the context, the connection
should be closed.</p>
<p>.. code-block:: python
:caption: <code>tests/test_db.py</code></p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">flaskr.db</span> <span class="kn">import</span> <span class="n">get_db</span>


<span class="k">def</span> <span class="nf">test_get_close_db</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">db</span> <span class="ow">is</span> <span class="n">get_db</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT 1&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="s1">&#39;closed&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>


<p>The <code>init-db</code> command should call the <code>init_db</code> function and output
a message.</p>
<p>.. code-block:: python
:caption: <code>tests/test_db.py</code></p>
<div class="codehilite"><pre><span></span>def test_init_db_command(runner, monkeypatch):
    class Recorder(object):
        called = False

    def fake_init_db():
        Recorder.called = True

    monkeypatch.setattr(&#39;flaskr.db.init_db&#39;, fake_init_db)
    result = runner.invoke(args=[&#39;init-db&#39;])
    assert &#39;Initialized&#39; in result.output
    assert Recorder.called
</pre></div>


<p>This test uses Pytest's <code>monkeypatch</code> fixture to replace the
<code>init_db</code> function with one that records that it's been called. The
<code>runner</code> fixture you wrote above is used to call the <code>init-db</code>
command by name.</p>
<h2 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h2>
<p>For most of the views, a user needs to be logged in. The easiest way to
do this in tests is to make a <code>POST</code> request to the <code>login</code> view
with the client. Rather than writing that out every time, you can write
a class with methods to do that, and use a fixture to pass it the client
for each test.</p>
<p>.. code-block:: python
:caption: <code>tests/conftest.py</code></p>
<div class="codehilite"><pre><span></span><span class="kr">class</span> <span class="nx">AuthActions</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">def</span> <span class="nx">__init__</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">client</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">_client</span> <span class="o">=</span> <span class="nx">client</span>

    <span class="nx">def</span> <span class="nx">login</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">username</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span><span class="o">:</span>
        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_client</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
            <span class="s1">&#39;/auth/login&#39;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="o">:</span> <span class="nx">password</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="nx">def</span> <span class="nx">logout</span><span class="p">(</span><span class="nx">self</span><span class="p">)</span><span class="o">:</span>
        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_client</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/auth/logout&#39;</span><span class="p">)</span>


<span class="kd">@pytest</span><span class="p">.</span><span class="nx">fixture</span>
<span class="nx">def</span> <span class="nx">auth</span><span class="p">(</span><span class="nx">client</span><span class="p">)</span><span class="o">:</span>
    <span class="k">return</span> <span class="nx">AuthActions</span><span class="p">(</span><span class="nx">client</span><span class="p">)</span>
</pre></div>


<p>With the <code>auth</code> fixture, you can call <code>auth.login()</code> in a test to
log in as the <code>test</code> user, which was inserted as part of the test
data in the <code>app</code> fixture.</p>
<p>The <code>register</code> view should render successfully on <code>GET</code>. On <code>POST</code>
with valid form data, it should redirect to the login URL and the user's
data should be in the database. Invalid data should display error
messages.</p>
<p>.. code-block:: python
:caption: <code>tests/test_auth.py</code></p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">g</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">from</span> <span class="nn">flaskr.db</span> <span class="kn">import</span> <span class="n">get_db</span>


<span class="k">def</span> <span class="nf">test_register</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/auth/register&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s1">&#39;/auth/register&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="s1">&#39;http://localhost/auth/login&#39;</span> <span class="o">==</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Location&#39;</span><span class="p">]</span>

    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">get_db</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;select * from user where username = &#39;a&#39;&quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>


<span class="nd">@pytest.mark.parametrize</span><span class="p">((</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">),</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Username is required.&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Password is required.&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;already registered&#39;</span><span class="p">),</span>
<span class="p">))</span>
<span class="k">def</span> <span class="nf">test_register_validate_input</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s1">&#39;/auth/register&#39;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
</pre></div>


<p>:meth:<code>client.get() &lt;werkzeug.test.Client.get&gt;</code> makes a <code>GET</code> request
and returns the :class:<code>Response</code> object returned by Flask. Similarly,
:meth:<code>client.post() &lt;werkzeug.test.Client.post&gt;</code> makes a <code>POST</code>
request, converting the <code>data</code> dict into form data.</p>
<p>To test that the page renders successfully, a simple request is made and
checked for a <code>200 OK</code> :attr:<code>~Response.status_code</code>. If
rendering failed, Flask would return a <code>500 Internal Server Error</code>
code.</p>
<p>:attr:<code>~Response.headers</code> will have a <code>Location</code> header with the login
URL when the register view redirects to the login view.</p>
<p>:attr:<code>~Response.data</code> contains the body of the response as bytes. If
you expect a certain value to render on the page, check that it's in
<code>data</code>. Bytes must be compared to bytes. If you want to compare
Unicode text, use :meth:<code>get_data(as_text=True) &lt;werkzeug.wrappers.BaseResponse.get_data&gt;</code>
instead.</p>
<p><code>pytest.mark.parametrize</code> tells Pytest to run the same test function
with different arguments. You use it here to test different invalid
input and error messages without writing the same code three times.</p>
<p>The tests for the <code>login</code> view are very similar to those for
<code>register</code>. Rather than testing the data in the database,
:data:<code>session</code> should have <code>user_id</code> set after logging in.</p>
<p>.. code-block:: python
:caption: <code>tests/test_auth.py</code></p>
<div class="codehilite"><pre><span></span>def test_login(client, auth):
    assert client.get(&#39;/auth/login&#39;).status_code == 200
    response = auth.login()
    assert response.headers[&#39;Location&#39;] == &#39;http://localhost/&#39;

    with client:
        client.get(&#39;/&#39;)
        assert session[&#39;user_id&#39;] == 1
        assert g.user[&#39;username&#39;] == &#39;test&#39;


@pytest.mark.parametrize((&#39;username&#39;, &#39;password&#39;, &#39;message&#39;), (
    (&#39;a&#39;, &#39;test&#39;, b&#39;Incorrect username.&#39;),
    (&#39;test&#39;, &#39;a&#39;, b&#39;Incorrect password.&#39;),
))
def test_login_validate_input(auth, username, password, message):
    response = auth.login(username, password)
    assert message in response.data
</pre></div>


<p>Using <code>client</code> in a <code>with</code> block allows accessing context variables
such as :data:<code>session</code> after the response is returned. Normally,
accessing <code>session</code> outside of a request would raise an error.</p>
<p>Testing <code>logout</code> is the opposite of <code>login</code>. :data:<code>session</code> should
not contain <code>user_id</code> after logging out.</p>
<p>.. code-block:: python
:caption: <code>tests/test_auth.py</code></p>
<div class="codehilite"><pre><span></span>def test_logout(client, auth):
    auth.login()

    with client:
        auth.logout()
        assert &#39;user_id&#39; not in session
</pre></div>


<h2 id="blog">Blog<a class="headerlink" href="#blog" title="Permanent link">&para;</a></h2>
<p>All the blog views use the <code>auth</code> fixture you wrote earlier. Call
<code>auth.login()</code> and subsequent requests from the client will be logged
in as the <code>test</code> user.</p>
<p>The <code>index</code> view should display information about the post that was
added with the test data. When logged in as the author, there should be
a link to edit the post.</p>
<p>You can also test some more authentication behavior while testing the
<code>index</code> view. When not logged in, each page shows links to log in or
register. When logged in, there's a link to log out.</p>
<p>.. code-block:: python
:caption: <code>tests/test_blog.py</code></p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">flaskr.db</span> <span class="kn">import</span> <span class="n">get_db</span>


<span class="k">def</span> <span class="nf">test_index</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">auth</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s2">&quot;Log In&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s2">&quot;Register&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>

    <span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;Log Out&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;test title&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;by test on 2018-01-01&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;test</span><span class="se">\n</span><span class="s1">body&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
    <span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;href=&quot;/1/update&quot;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
</pre></div>


<p>A user must be logged in to access the <code>create</code>, <code>update</code>, and
<code>delete</code> views. The logged in user must be the author of the post to
access <code>update</code> and <code>delete</code>, otherwise a <code>403 Forbidden</code> status
is returned. If a <code>post</code> with the given <code>id</code> doesn't exist,
<code>update</code> and <code>delete</code> should return <code>404 Not Found</code>.</p>
<p>.. code-block:: python
:caption: <code>tests/test_blog.py</code></p>
<div class="codehilite"><pre><span></span>@pytest.mark.parametrize(&#39;path&#39;, (
    &#39;/create&#39;,
    &#39;/1/update&#39;,
    &#39;/1/delete&#39;,
))
def test_login_required(client, path):
    response = client.post(path)
    assert response.headers[&#39;Location&#39;] == &#39;http://localhost/auth/login&#39;


def test_author_required(app, client, auth):
    # change the post author to another user
    with app.app_context():
        db = get_db()
        db.execute(&#39;UPDATE post SET author_id = 2 WHERE id = 1&#39;)
        db.commit()

    auth.login()
    # current user can&#39;t modify other user&#39;s post
    assert client.post(&#39;/1/update&#39;).status_code == 403
    assert client.post(&#39;/1/delete&#39;).status_code == 403
    # current user doesn&#39;t see edit link
    assert b&#39;href=&quot;/1/update&quot;&#39; not in client.get(&#39;/&#39;).data


@pytest.mark.parametrize(&#39;path&#39;, (
    &#39;/2/update&#39;,
    &#39;/2/delete&#39;,
))
def test_exists_required(client, auth, path):
    auth.login()
    assert client.post(path).status_code == 404
</pre></div>


<p>The <code>create</code> and <code>update</code> views should render and return a
<code>200 OK</code> status for a <code>GET</code> request. When valid data is sent in a
<code>POST</code> request, <code>create</code> should insert the new post data into the
database, and <code>update</code> should modify the existing data. Both pages
should show an error message on invalid data.</p>
<p>.. code-block:: python
:caption: <code>tests/test_blog.py</code></p>
<div class="codehilite"><pre><span></span>def test_create(client, auth, app):
    auth.login()
    assert client.get(&#39;/create&#39;).status_code == 200
    client.post(&#39;/create&#39;, data={&#39;title&#39;: &#39;created&#39;, &#39;body&#39;: &#39;&#39;})

    with app.app_context():
        db = get_db()
        count = db.execute(&#39;SELECT COUNT(id) FROM post&#39;).fetchone()[0]
        assert count == 2


def test_update(client, auth, app):
    auth.login()
    assert client.get(&#39;/1/update&#39;).status_code == 200
    client.post(&#39;/1/update&#39;, data={&#39;title&#39;: &#39;updated&#39;, &#39;body&#39;: &#39;&#39;})

    with app.app_context():
        db = get_db()
        post = db.execute(&#39;SELECT * FROM post WHERE id = 1&#39;).fetchone()
        assert post[&#39;title&#39;] == &#39;updated&#39;


@pytest.mark.parametrize(&#39;path&#39;, (
    &#39;/create&#39;,
    &#39;/1/update&#39;,
))
def test_create_update_validate(client, auth, path):
    auth.login()
    response = client.post(path, data={&#39;title&#39;: &#39;&#39;, &#39;body&#39;: &#39;&#39;})
    assert b&#39;Title is required.&#39; in response.data
</pre></div>


<p>The <code>delete</code> view should redirect to the index URL and the post should
no longer exist in the database.</p>
<p>.. code-block:: python
:caption: <code>tests/test_blog.py</code></p>
<div class="codehilite"><pre><span></span>def test_delete(client, auth, app):
    auth.login()
    response = client.post(&#39;/1/delete&#39;)
    assert response.headers[&#39;Location&#39;] == &#39;http://localhost/&#39;

    with app.app_context():
        db = get_db()
        post = db.execute(&#39;SELECT * FROM post WHERE id = 1&#39;).fetchone()
        assert post is None
</pre></div>


<h2 id="running-the-tests">Running the Tests<a class="headerlink" href="#running-the-tests" title="Permanent link">&para;</a></h2>
<p>Some extra configuration, which is not required but makes running
tests with coverage less verbose, can be added to the project's
<code>setup.cfg</code> file.</p>
<p>.. code-block:: none
:caption: <code>setup.cfg</code></p>
<div class="codehilite"><pre><span></span><span class="k">[tool:pytest]</span>
<span class="na">testpaths</span> <span class="o">=</span> <span class="s">tests</span>

<span class="k">[coverage:run]</span>
<span class="na">branch</span> <span class="o">=</span> <span class="s">True</span>
<span class="na">source</span> <span class="o">=</span><span class="s"></span>
<span class="s">    flaskr</span>
</pre></div>


<p>To run the tests, use the <code>pytest</code> command. It will find and run all
the test functions you've written.</p>
<p>.. code-block:: none</p>
<div class="codehilite"><pre><span></span>$ <span class="nv">pytest</span>

<span class="o">=========================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">==========================</span>
platform linux -- Python <span class="m">3</span>.6.4, pytest-3.5.0, py-1.5.3, pluggy-0.6.0
rootdir: /home/user/Projects/flask-tutorial, inifile: setup.cfg
collected <span class="m">23</span> items

tests/test_auth.py ........                                      <span class="o">[</span> <span class="m">34</span>%<span class="o">]</span>
tests/test_blog.py ............                                  <span class="o">[</span> <span class="m">86</span>%<span class="o">]</span>
tests/test_db.py ..                                              <span class="o">[</span> <span class="m">95</span>%<span class="o">]</span>
tests/test_factory.py ..                                         <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">======================</span> <span class="m">24</span> passed in <span class="m">0</span>.64 <span class="nv">seconds</span> <span class="o">=======================</span>
</pre></div>


<p>If any tests fail, pytest will show the error that was raised. You can
run <code>pytest -v</code> to get a list of each test function rather than dots.</p>
<p>To measure the code coverage of your tests, use the <code>coverage</code> command
to run pytest instead of running it directly.</p>
<p>.. code-block:: none</p>
<div class="codehilite"><pre><span></span>$ coverage run -m pytest
</pre></div>


<p>You can either view a simple coverage report in the terminal:</p>
<p>.. code-block:: none</p>
<div class="codehilite"><pre><span></span>$ coverage report

Name                 Stmts   Miss Branch BrPart  Cover
------------------------------------------------------
flaskr/__init__.py      <span class="m">21</span>      <span class="m">0</span>      <span class="m">2</span>      <span class="m">0</span>   <span class="m">100</span>%
flaskr/auth.py          <span class="m">54</span>      <span class="m">0</span>     <span class="m">22</span>      <span class="m">0</span>   <span class="m">100</span>%
flaskr/blog.py          <span class="m">54</span>      <span class="m">0</span>     <span class="m">16</span>      <span class="m">0</span>   <span class="m">100</span>%
flaskr/db.py            <span class="m">24</span>      <span class="m">0</span>      <span class="m">4</span>      <span class="m">0</span>   <span class="m">100</span>%
------------------------------------------------------
TOTAL                  <span class="m">153</span>      <span class="m">0</span>     <span class="m">44</span>      <span class="m">0</span>   <span class="m">100</span>%
</pre></div>


<p>An HTML report allows you to see which lines were covered in each file:</p>
<p>.. code-block:: none</p>
<div class="codehilite"><pre><span></span>$ coverage html
</pre></div>


<p>This generates files in the <code>htmlcov</code> directory. Open
<code>htmlcov/index.html</code> in your browser to see the report.</p>
<p>Continue to :doc:<code>deploy</code>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../templates/" title="Templates" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                Templates
              </span>
            </div>
          </a>
        
        
          <a href="../views/" title="Views" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                Views
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            @2018 nlp-docs.github.io
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="http://wohugb.github.io" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/wohugb" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/wohugb" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/wohugb" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.2ba8dec4.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>