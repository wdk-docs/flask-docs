



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="自然语言处理文档">
      
      
      
        <meta name="author" content="Nosy">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.0">
    
    
      
        <title>Testing Flask Applications - Flask Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#testing-flask-applications" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Flask Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Flask Docs
            </span>
            <span class="md-header-nav__topic">
              Testing Flask Applications
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/wohugb/nlp-docs" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    nlp-docs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="欢迎来到 Flask" class="md-tabs__link md-tabs__link--active">
        欢迎来到 Flask
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../deploying/" title="Deploying" class="md-tabs__link">
          Deploying
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../patterns/" title="Patterns" class="md-tabs__link">
          Patterns
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../tutorial/" title="Tutorial" class="md-tabs__link">
          Tutorial
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Flask Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Flask Docs
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/wohugb/nlp-docs" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    nlp-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="欢迎来到 Flask" class="md-nav__link">
      欢迎来到 Flask
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../10.foreword/" title="前言" class="md-nav__link">
      前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../11.advanced_foreword/" title="有经验的程序员的前言" class="md-nav__link">
      有经验的程序员的前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../12.installation/" title="安装" class="md-nav__link">
      安装
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../13.quickstart/" title="Quickstart" class="md-nav__link">
      Quickstart
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../15.templating/" title="Templates" class="md-nav__link">
      Templates
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../appcontext/" title="Appcontext" class="md-nav__link">
      Appcontext
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../becomingbig/" title="Becoming Big" class="md-nav__link">
      Becoming Big
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../blueprints/" title="Modular Applications with Blueprints" class="md-nav__link">
      Modular Applications with Blueprints
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cli/" title="Cli" class="md-nav__link">
      Cli
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../config/" title="Configuration Handling" class="md-nav__link">
      Configuration Handling
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../design/" title="Design Decisions in Flask" class="md-nav__link">
      Design Decisions in Flask
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../errorhandling/" title="Application Errors" class="md-nav__link">
      Application Errors
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../extensiondev/" title="Flask Extension Development" class="md-nav__link">
      Flask Extension Development
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../htmlfaq/" title="HTML/XHTML FAQ" class="md-nav__link">
      HTML/XHTML FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../latexindex/" title="Latexindex" class="md-nav__link">
      Latexindex
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../reqcontext/" title="Reqcontext" class="md-nav__link">
      Reqcontext
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../security/" title="Security Considerations" class="md-nav__link">
      Security Considerations
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../server/" title="Development Server" class="md-nav__link">
      Development Server
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../shell/" title="Working with the Shell" class="md-nav__link">
      Working with the Shell
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../signals/" title="Signals" class="md-nav__link">
      Signals
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../styleguide/" title="Pocoo Styleguide" class="md-nav__link">
      Pocoo Styleguide
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Testing Flask Applications
      </label>
    
    <a href="./" title="Testing Flask Applications" class="md-nav__link md-nav__link--active">
      Testing Flask Applications
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-application" title="The Application" class="md-nav__link">
    The Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-testing-skeleton" title="The Testing Skeleton" class="md-nav__link">
    The Testing Skeleton
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-first-test" title="The First Test" class="md-nav__link">
    The First Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging-in-and-out" title="Logging In and Out" class="md-nav__link">
    Logging In and Out
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-adding-messages" title="Test Adding Messages" class="md-nav__link">
    Test Adding Messages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-testing-tricks" title="Other Testing Tricks" class="md-nav__link">
    Other Testing Tricks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faking-resources-and-context" title="Faking Resources and Context" class="md-nav__link">
    Faking Resources and Context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keeping-the-context-around" title="Keeping the Context Around" class="md-nav__link">
    Keeping the Context Around
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-and-modifying-sessions" title="Accessing and Modifying Sessions" class="md-nav__link">
    Accessing and Modifying Sessions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-json-apis" title="Testing JSON APIs" class="md-nav__link">
    Testing JSON APIs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-cli-commands" title="Testing CLI Commands" class="md-nav__link">
    Testing CLI Commands
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../unicode/" title="Unicode in Flask" class="md-nav__link">
      Unicode in Flask
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../upgrading/" title="Upgrading to Newer Releases" class="md-nav__link">
      Upgrading to Newer Releases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../views/" title="Pluggable Views" class="md-nav__link">
      Pluggable Views
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-33" type="checkbox" id="nav-33">
    
    <label class="md-nav__link" for="nav-33">
      Deploying
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-33">
        Deploying
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../deploying/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploying/cgi/" title="CGI" class="md-nav__link">
      CGI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploying/fastcgi/" title="Fastcgi" class="md-nav__link">
      Fastcgi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploying/mod_wsgi/" title="Mod wsgi" class="md-nav__link">
      Mod wsgi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploying/uwsgi/" title="Uwsgi" class="md-nav__link">
      Uwsgi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploying/wsgi-standalone/" title="Wsgi standalone" class="md-nav__link">
      Wsgi standalone
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-34" type="checkbox" id="nav-34">
    
    <label class="md-nav__link" for="nav-34">
      Patterns
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-34">
        Patterns
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/apierrors/" title="Implementing API Exceptions" class="md-nav__link">
      Implementing API Exceptions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/appdispatch/" title="Appdispatch" class="md-nav__link">
      Appdispatch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/appfactories/" title="Appfactories" class="md-nav__link">
      Appfactories
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/caching/" title="Caching" class="md-nav__link">
      Caching
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/celery/" title="Celery Background Tasks" class="md-nav__link">
      Celery Background Tasks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/deferredcallbacks/" title="Deferredcallbacks" class="md-nav__link">
      Deferredcallbacks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/distribute/" title="Distribute" class="md-nav__link">
      Distribute
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/errorpages/" title="Errorpages" class="md-nav__link">
      Errorpages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/fabric/" title="Fabric" class="md-nav__link">
      Fabric
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/favicon/" title="Adding a favicon" class="md-nav__link">
      Adding a favicon
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/fileuploads/" title="Fileuploads" class="md-nav__link">
      Fileuploads
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/flashing/" title="Flashing" class="md-nav__link">
      Flashing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/jquery/" title="AJAX with jQuery" class="md-nav__link">
      AJAX with jQuery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/lazyloading/" title="Lazily Loading Views" class="md-nav__link">
      Lazily Loading Views
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/methodoverrides/" title="Adding HTTP Method Overrides" class="md-nav__link">
      Adding HTTP Method Overrides
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/mongoengine/" title="MongoDB with MongoEngine" class="md-nav__link">
      MongoDB with MongoEngine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/mongokit/" title="Mongokit" class="md-nav__link">
      Mongokit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/packages/" title="Packages" class="md-nav__link">
      Packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/requestchecksum/" title="Request Content Checksums" class="md-nav__link">
      Request Content Checksums
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/singlepageapplications/" title="Single-Page Applications" class="md-nav__link">
      Single-Page Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/sqlalchemy/" title="Sqlalchemy" class="md-nav__link">
      Sqlalchemy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/sqlite3/" title="Sqlite3" class="md-nav__link">
      Sqlite3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/streaming/" title="Streaming Contents" class="md-nav__link">
      Streaming Contents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/subclassing/" title="Subclassing Flask" class="md-nav__link">
      Subclassing Flask
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/templateinheritance/" title="Templateinheritance" class="md-nav__link">
      Templateinheritance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/urlprocessors/" title="Using URL Processors" class="md-nav__link">
      Using URL Processors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/viewdecorators/" title="View Decorators" class="md-nav__link">
      View Decorators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../patterns/wtforms/" title="Form Validation with WTForms" class="md-nav__link">
      Form Validation with WTForms
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-35" type="checkbox" id="nav-35">
    
    <label class="md-nav__link" for="nav-35">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-35">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/blog/" title="Blog" class="md-nav__link">
      Blog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/database/" title="Database" class="md-nav__link">
      Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/deploy/" title="Deploy to Production" class="md-nav__link">
      Deploy to Production
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/factory/" title="Factory" class="md-nav__link">
      Factory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/install/" title="Make the Project Installable" class="md-nav__link">
      Make the Project Installable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/layout/" title="Project Layout" class="md-nav__link">
      Project Layout
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/next/" title="Keep Developing!" class="md-nav__link">
      Keep Developing!
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/static/" title="Static Files" class="md-nav__link">
      Static Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/templates/" title="Templates" class="md-nav__link">
      Templates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/tests/" title="Tests" class="md-nav__link">
      Tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/views/" title="Views" class="md-nav__link">
      Views
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-application" title="The Application" class="md-nav__link">
    The Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-testing-skeleton" title="The Testing Skeleton" class="md-nav__link">
    The Testing Skeleton
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-first-test" title="The First Test" class="md-nav__link">
    The First Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging-in-and-out" title="Logging In and Out" class="md-nav__link">
    Logging In and Out
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-adding-messages" title="Test Adding Messages" class="md-nav__link">
    Test Adding Messages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-testing-tricks" title="Other Testing Tricks" class="md-nav__link">
    Other Testing Tricks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faking-resources-and-context" title="Faking Resources and Context" class="md-nav__link">
    Faking Resources and Context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keeping-the-context-around" title="Keeping the Context Around" class="md-nav__link">
    Keeping the Context Around
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-and-modifying-sessions" title="Accessing and Modifying Sessions" class="md-nav__link">
    Accessing and Modifying Sessions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-json-apis" title="Testing JSON APIs" class="md-nav__link">
    Testing JSON APIs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-cli-commands" title="Testing CLI Commands" class="md-nav__link">
    Testing CLI Commands
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="testing-flask-applications">Testing Flask Applications<a class="headerlink" href="#testing-flask-applications" title="Permanent link">&para;</a></h1>
<p><strong>Something that is untested is broken.</strong></p>
<p>The origin of this quote is unknown and while it is not entirely correct, it
is also not far from the truth. Untested applications make it hard to
improve existing code and developers of untested applications tend to
become pretty paranoid. If an application has automated tests, you can
safely make changes and instantly know if anything breaks.</p>
<p>Flask provides a way to test your application by exposing the Werkzeug
test :class:<code>~werkzeug.test.Client</code> and handling the context locals for you.
You can then use that with your favourite testing solution.</p>
<p>In this documentation we will use the <code>pytest</code>_ package as the base
framework for our tests. You can install it with <code>pip</code>, like so::</p>
<div class="codehilite"><pre><span></span>$ pip install pytest
</pre></div>


<p>https://pytest.org</p>
<h2 id="the-application">The Application<a class="headerlink" href="#the-application" title="Permanent link">&para;</a></h2>
<p>First, we need an application to test; we will use the application from
the :ref:<code>tutorial</code>. If you don't have that application yet, get the
source code from :gh:<code>the examples &lt;examples/tutorial&gt;</code>.</p>
<h2 id="the-testing-skeleton">The Testing Skeleton<a class="headerlink" href="#the-testing-skeleton" title="Permanent link">&para;</a></h2>
<p>We begin by adding a tests directory under the application root. Then
create a Python file to store our tests (:file:<code>test_flaskr.py</code>). When we
format the filename like <code>test_*.py</code>, it will be auto-discoverable by
pytest.</p>
<p>Next, we create a <code>pytest fixture</code>_ called
:func:<code>client</code> that configures
the application for testing and initializes a new database::</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">from</span> <span class="nn">flaskr</span> <span class="kn">import</span> <span class="n">flaskr</span>


<span class="nd">@pytest.fixture</span>
<span class="k">def</span> <span class="nf">client</span><span class="p">():</span>
    <span class="n">db_fd</span><span class="p">,</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
    <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;TESTING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
        <span class="n">flaskr</span><span class="o">.</span><span class="n">init_db</span><span class="p">()</span>

    <span class="k">yield</span> <span class="n">client</span>

    <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">db_fd</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">])</span>
</pre></div>


<p>This client fixture will be called by each individual test. It gives us a
simple interface to the application, where we can trigger test requests to the
application. The client will also keep track of cookies for us.</p>
<p>During setup, the <code>TESTING</code> config flag is activated. What
this does is disable error catching during request handling, so that
you get better error reports when performing test requests against the
application.</p>
<p>Because SQLite3 is filesystem-based, we can easily use the :mod:<code>tempfile</code> module
to create a temporary database and initialize it. The
:func:<code>~tempfile.mkstemp</code> function does two things for us: it returns a
low-level file handle and a random file name, the latter we use as
database name. We just have to keep the <code>db_fd</code> around so that we can use
the :func:<code>os.close</code> function to close the file.</p>
<p>To delete the database after the test, the fixture closes the file and removes
it from the filesystem.</p>
<p>If we now run the test suite, we should see the following output::</p>
<div class="codehilite"><pre><span></span>$ <span class="nv">pytest</span>

<span class="o">================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">================</span>
rootdir: ./flask/examples/flaskr, inifile: setup.cfg
collected <span class="m">0</span> <span class="nv">items</span>

<span class="o">===========</span> no tests ran in <span class="m">0</span>.07 <span class="nv">seconds</span> <span class="o">============</span>
</pre></div>


<p>Even though it did not run any actual tests, we already know that our <code>flaskr</code>
application is syntactically valid, otherwise the import would have died
with an exception.</p>
<p>https://docs.pytest.org/en/latest/fixture.html</p>
<h2 id="the-first-test">The First Test<a class="headerlink" href="#the-first-test" title="Permanent link">&para;</a></h2>
<p>Now it's time to start testing the functionality of the application.
Let's check that the application shows "No entries here so far" if we
access the root of the application (<code>/</code>). To do this, we add a new
test function to :file:<code>test_flaskr.py</code>, like this::</p>
<div class="codehilite"><pre><span></span>def test_empty_db(client):
    &quot;&quot;&quot;Start with a blank database.&quot;&quot;&quot;

    rv = client.get(&#39;/&#39;)
    assert b&#39;No entries here so far&#39; in rv.data
</pre></div>


<p>Notice that our test functions begin with the word <code>test</code>; this allows
<code>pytest</code>_ to automatically identify the function as a test to run.</p>
<p>By using <code>client.get</code> we can send an HTTP <code>GET</code> request to the application with
the given path. The return value will be a :class:<code>~flask.Flask.response_class</code> object.
We can now use the :attr:<code>~werkzeug.wrappers.BaseResponse.data</code> attribute to inspect
the return value (as string) from the application. In this case, we ensure that
<code>'No entries here so far'</code> is part of the output.</p>
<p>Run it again and you should see one passing test::</p>
<div class="codehilite"><pre><span></span>$ pytest -v

<span class="o">================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">================</span>
rootdir: ./flask/examples/flaskr, inifile: setup.cfg
collected <span class="m">1</span> items

tests/test_flaskr.py::test_empty_db <span class="nv">PASSED</span>

<span class="o">=============</span> <span class="m">1</span> passed in <span class="m">0</span>.10 <span class="nv">seconds</span> <span class="o">==============</span>
</pre></div>


<h2 id="logging-in-and-out">Logging In and Out<a class="headerlink" href="#logging-in-and-out" title="Permanent link">&para;</a></h2>
<p>The majority of the functionality of our application is only available for
the administrative user, so we need a way to log our test client in and out
of the application. To do this, we fire some requests to the login and logout
pages with the required form data (username and password). And because the
login and logout pages redirect, we tell the client to <code>follow_redirects</code>.</p>
<p>Add the following two functions to your :file:<code>test_flaskr.py</code> file::</p>
<div class="codehilite"><pre><span></span>def login(client, username, password):
    return client.post(&#39;/login&#39;, data=dict(
        username=username,
        password=password
    ), follow_redirects=True)


def logout(client):
    return client.get(&#39;/logout&#39;, follow_redirects=True)
</pre></div>


<p>Now we can easily test that logging in and out works and that it fails with
invalid credentials. Add this new test function::</p>
<div class="codehilite"><pre><span></span>def test_login_logout(client):
    &quot;&quot;&quot;Make sure login and logout works.&quot;&quot;&quot;

    rv = login(client, flaskr.app.config[&#39;USERNAME&#39;], flaskr.app.config[&#39;PASSWORD&#39;])
    assert b&#39;You were logged in&#39; in rv.data

    rv = logout(client)
    assert b&#39;You were logged out&#39; in rv.data

    rv = login(client, flaskr.app.config[&#39;USERNAME&#39;] + &#39;x&#39;, flaskr.app.config[&#39;PASSWORD&#39;])
    assert b&#39;Invalid username&#39; in rv.data

    rv = login(client, flaskr.app.config[&#39;USERNAME&#39;], flaskr.app.config[&#39;PASSWORD&#39;] + &#39;x&#39;)
    assert b&#39;Invalid password&#39; in rv.data
</pre></div>


<h2 id="test-adding-messages">Test Adding Messages<a class="headerlink" href="#test-adding-messages" title="Permanent link">&para;</a></h2>
<p>We should also test that adding messages works. Add a new test function
like this::</p>
<div class="codehilite"><pre><span></span>def test_messages(client):
    &quot;&quot;&quot;Test that messages work.&quot;&quot;&quot;

    login(client, flaskr.app.config[&#39;USERNAME&#39;], flaskr.app.config[&#39;PASSWORD&#39;])
    rv = client.post(&#39;/add&#39;, data=dict(
        title=&#39;&amp;lt;Hello&amp;gt;&#39;,
        text=&#39;&amp;lt;strong&amp;gt;HTML&amp;lt;/strong&amp;gt; allowed here&#39;
    ), follow_redirects=True)
    assert b&#39;No entries here so far&#39; not in rv.data
    assert b&#39;&amp;amp;lt;Hello&amp;amp;gt;&#39; in rv.data
    assert b&#39;&amp;lt;strong&amp;gt;HTML&amp;lt;/strong&amp;gt; allowed here&#39; in rv.data
</pre></div>


<p>Here we check that HTML is allowed in the text but not in the title,
which is the intended behavior.</p>
<p>Running that should now give us three passing tests::</p>
<div class="codehilite"><pre><span></span>$ pytest -v

<span class="o">================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">================</span>
rootdir: ./flask/examples/flaskr, inifile: setup.cfg
collected <span class="m">3</span> items

tests/test_flaskr.py::test_empty_db PASSED
tests/test_flaskr.py::test_login_logout PASSED
tests/test_flaskr.py::test_messages <span class="nv">PASSED</span>

<span class="o">=============</span> <span class="m">3</span> passed in <span class="m">0</span>.23 <span class="nv">seconds</span> <span class="o">==============</span>
</pre></div>


<h2 id="other-testing-tricks">Other Testing Tricks<a class="headerlink" href="#other-testing-tricks" title="Permanent link">&para;</a></h2>
<p>Besides using the test client as shown above, there is also the
:meth:<code>~flask.Flask.test_request_context</code> method that can be used
in combination with the <code>with</code> statement to activate a request context
temporarily. With this you can access the :class:<code>~flask.request</code>,
:class:<code>~flask.g</code> and :class:<code>~flask.session</code> objects like in view
functions. Here is a full example that demonstrates this approach::</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">(</span><span class="s1">&#39;/?name=Peter&#39;</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span>
    <span class="k">assert</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Peter&#39;</span>
</pre></div>


<p>All the other objects that are context bound can be used in the same
way.</p>
<p>If you want to test your application with different configurations and
there does not seem to be a good way to do that, consider switching to
application factories (see :ref:<code>app-factories</code>).</p>
<p>Note however that if you are using a test request context, the
:meth:<code>~flask.Flask.before_request</code> and :meth:<code>~flask.Flask.after_request</code>
functions are not called automatically. However
:meth:<code>~flask.Flask.teardown_request</code> functions are indeed executed when
the test request context leaves the <code>with</code> block. If you do want the
:meth:<code>~flask.Flask.before_request</code> functions to be called as well, you
need to call :meth:<code>~flask.Flask.preprocess_request</code> yourself::</p>
<div class="codehilite"><pre><span></span>app = flask.Flask(__name__)

with app.test_request_context(&#39;/?name=Peter&#39;):
    app.preprocess_request()
    ...
</pre></div>


<p>This can be necessary to open database connections or something similar
depending on how your application was designed.</p>
<p>If you want to call the :meth:<code>~flask.Flask.after_request</code> functions you
need to call into :meth:<code>~flask.Flask.process_response</code> which however
requires that you pass it a response object::</p>
<div class="codehilite"><pre><span></span>app = flask.Flask(__name__)

with app.test_request_context(&#39;/?name=Peter&#39;):
    resp = Response(&#39;...&#39;)
    resp = app.process_response(resp)
    ...
</pre></div>


<p>This in general is less useful because at that point you can directly
start using the test client.</p>
<h2 id="faking-resources-and-context">Faking Resources and Context<a class="headerlink" href="#faking-resources-and-context" title="Permanent link">&para;</a></h2>
<p>.. versionadded:: 0.10</p>
<p>A very common pattern is to store user authorization information and
database connections on the application context or the :attr:<code>flask.g</code>
object. The general pattern for this is to put the object on there on
first usage and then to remove it on a teardown. Imagine for instance
this code to get the current user::</p>
<div class="codehilite"><pre><span></span>def get_user():
    user = getattr(g, &#39;user&#39;, None)
    if user is None:
        user = fetch_current_user_from_database()
        g.user = user
    return user
</pre></div>


<p>For a test it would be nice to override this user from the outside without
having to change some code. This can be accomplished with
hooking the :data:<code>flask.appcontext_pushed</code> signal::</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">appcontext_pushed</span><span class="p">,</span> <span class="n">g</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">user_set</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="k">with</span> <span class="n">appcontext_pushed</span><span class="o">.</span><span class="n">connected_to</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="k">yield</span>
</pre></div>


<p>And then to use it::</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">json</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/users/me&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">users_me</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>

<span class="k">with</span> <span class="n">user_set</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">my_user</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/users/me&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_equal</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">my_user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
</pre></div>


<h2 id="keeping-the-context-around">Keeping the Context Around<a class="headerlink" href="#keeping-the-context-around" title="Permanent link">&para;</a></h2>
<p>.. versionadded:: 0.4</p>
<p>Sometimes it is helpful to trigger a regular request but still keep the
context around for a little longer so that additional introspection can
happen. With Flask 0.4 this is possible by using the
:meth:<code>~flask.Flask.test_client</code> with a <code>with</code> block::</p>
<div class="codehilite"><pre><span></span>app = flask.Flask(__name__)

with app.test_client() as c:
    rv = c.get(&#39;/?tequila=42&#39;)
    assert request.args[&#39;tequila&#39;] == &#39;42&#39;
</pre></div>


<p>If you were to use just the :meth:<code>~flask.Flask.test_client</code> without
the <code>with</code> block, the <code>assert</code> would fail with an error because <code>request</code>
is no longer available (because you are trying to use it outside of the actual request).</p>
<h2 id="accessing-and-modifying-sessions">Accessing and Modifying Sessions<a class="headerlink" href="#accessing-and-modifying-sessions" title="Permanent link">&para;</a></h2>
<p>.. versionadded:: 0.8</p>
<p>Sometimes it can be very helpful to access or modify the sessions from the
test client. Generally there are two ways for this. If you just want to
ensure that a session has certain keys set to certain values you can just
keep the context around and access :data:<code>flask.session</code>::</p>
<div class="codehilite"><pre><span></span>with app.test_client() as c:
    rv = c.get(&#39;/&#39;)
    assert flask.session[&#39;foo&#39;] == 42
</pre></div>


<p>This however does not make it possible to also modify the session or to
access the session before a request was fired. Starting with Flask 0.8 we
provide a so called “session transaction” which simulates the appropriate
calls to open a session in the context of the test client and to modify
it. At the end of the transaction the session is stored. This works
independently of the session backend used::</p>
<div class="codehilite"><pre><span></span>with app.test_client() as c:
    with c.session_transaction() as sess:
        sess[&#39;a_key&#39;] = &#39;a value&#39;

    # once this is reached the session was stored
</pre></div>


<p>Note that in this case you have to use the <code>sess</code> object instead of the
:data:<code>flask.session</code> proxy. The object however itself will provide the
same interface.</p>
<h2 id="testing-json-apis">Testing JSON APIs<a class="headerlink" href="#testing-json-apis" title="Permanent link">&para;</a></h2>
<p>.. versionadded:: 1.0</p>
<p>Flask has great support for JSON, and is a popular choice for building JSON
APIs. Making requests with JSON data and examining JSON data in responses is
very convenient::</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/api/auth&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">auth</span><span class="p">():</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">generate_token</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/api/auth&#39;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;flask@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;secret&#39;</span>
    <span class="p">})</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">verify_token</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">])</span>
</pre></div>


<p>Passing the <code>json</code> argument in the test client methods sets the request data
to the JSON-serialized object and sets the content type to
<code>application/json</code>. You can get the JSON data from the request or response
with <code>get_json</code>.</p>
<h2 id="testing-cli-commands">Testing CLI Commands<a class="headerlink" href="#testing-cli-commands" title="Permanent link">&para;</a></h2>
<p>Click comes with <code>utilities for testing</code>_ your CLI commands. A
:class:<code>~click.testing.CliRunner</code> runs commands in isolation and
captures the output in a :class:<code>~click.testing.Result</code> object.</p>
<p>Flask provides :meth:<code>~flask.Flask.test_cli_runner</code> to create a
:class:<code>~flask.testing.FlaskCliRunner</code> that passes the Flask app to the
CLI automatically. Use its :meth:<code>~flask.testing.FlaskCliRunner.invoke</code>
method to call commands in the same way they would be called from the
command line. ::</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>

<span class="nd">@app.cli.command</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;World&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_command</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Hello, {name}!&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_hello</span><span class="p">():</span>
    <span class="n">runner</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_cli_runner</span><span class="p">()</span>

    <span class="c1"># invoke the command directly</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">hello_command</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--name&#39;</span><span class="p">,</span> <span class="s1">&#39;Flask&#39;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="s1">&#39;Hello, Flask&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span>

    <span class="c1"># or by name</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="s1">&#39;World&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">output</span>
</pre></div>


<p>In the example above, invoking the command by name is useful because it
verifies that the command was correctly registered with the app.</p>
<p>If you want to test how your command parses parameters, without running
the command, use its :meth:<code>~click.BaseCommand.make_context</code> method.
This is useful for testing complex validation rules and custom types. ::</p>
<div class="codehilite"><pre><span></span>def upper(ctx, param, value):
    if value is not None:
        return value.upper()

@app.cli.command(&#39;hello&#39;)
@click.option(&#39;--name&#39;, default=&#39;World&#39;, callback=upper)
def hello_command(name)
    click.echo(f&#39;Hello, {name}!&#39;)

def test_hello_params():
    context = hello_command.make_context(&#39;hello&#39;, [&#39;--name&#39;, &#39;flask&#39;])
    assert context.params[&#39;name&#39;] == &#39;FLASK&#39;
</pre></div>


<p>.. _click: http://click.pocoo.org/
.. _utilities for testing: http://click.pocoo.org/testing</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../styleguide/" title="Pocoo Styleguide" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                Pocoo Styleguide
              </span>
            </div>
          </a>
        
        
          <a href="../unicode/" title="Unicode in Flask" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                Unicode in Flask
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            @2018 nlp-docs.github.io
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="http://wohugb.github.io" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/wohugb" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/wohugb" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/wohugb" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.2ba8dec4.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>